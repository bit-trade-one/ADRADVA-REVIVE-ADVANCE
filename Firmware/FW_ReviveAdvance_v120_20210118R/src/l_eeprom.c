#include "app.h"
#include "l_spi.h"
#include "l_eeprom.h"
#include "main_sub.h"


// 設定情報
UN_SW_INFOS my_sw_infos;            // [16*15byte]=240 SW設定情報読み込みバッファ
UN_AN_INFOS my_an_infos;            // [32*8byte]=256 ANALOG設定情報読み込みバッファ

#if 1
// EEPROM デフォルト値
const BYTE c_eeprom_default_data[EEPROM_DEFAULT_DATA_SIZE] = {
0x55,0xAA,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// SW
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// AN
ANALOG_SET_TYPE_JOYSTICK_X,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Y,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Z,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RX,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RY,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RZ,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
#endif

#if 0
// EEPROM テスト値マウス
const BYTE c_eeprom_default_data[EEPROM_DEFAULT_DATA_SIZE] = {
0x55,0xAA,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// SW
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x32,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_MOUSE,0x19,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_NONE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_KEYBOARD,0x32,0x00,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x01,0x08,0x01,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// AN
ANALOG_SET_TYPE_JOYSTICK_X,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Y,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Z,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RX,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RY,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RZ,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
#endif

#if 0
// EEPROM テスト値ジョイスティック
const BYTE c_eeprom_default_data[EEPROM_DEFAULT_DATA_SIZE] = {
0x55,0xAA,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// SW
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_NONE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_KEYBOARD,0x32,0x00,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
SW_SET_DEVICE_TYPE_JOYSTICK,0x32,0x00,0x01,0x08,0x01,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
// AN
ANALOG_SET_TYPE_JOYSTICK_X,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Y,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_Z,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RX,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RY,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_JOYSTICK_RZ,0x32,0x00,0x02,0x00,0x00,0xFF,0x00,0x05,0x00,0x00,0xA5,0x80,0x01,0x45,0xFF,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
ANALOG_SET_TYPE_NONE,0x32,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
#endif

//=========================================================
// low level access
//=========================================================
void eeprom_send_adr(EEPROM_ADR adr);
void eeprom_wrsr(char val);
void eeprom_write_byte(EEPROM_ADR adr,BYTE data);
void eeprom_write_word(EEPROM_ADR adr,WORD data);
BYTE eeprom_rdsr(void);
BYTE eeprom_busy(void);
void eeprom_wait_wip(void);
BYTE eeprom_read_byte(EEPROM_ADR adr);
WORD eeprom_read_word(EEPROM_ADR adr);
void eeprom_read_adr(EEPROM_ADR adr);
void eeprom_wren(void);
void eeprom_wrdi(void);

void eeprom_continuous_start(void);
void eeprom_continuous_end(void);
void eeprom_continuous_write(EEPROM_ADR adr);
void eeprom_continuous_read(EEPROM_ADR adr);
BYTE eeprom_continuous_access_w(BYTE data);
BYTE eeprom_continuous_access_r();

//=========================================================
// hi level access
//=========================================================
void eeprom_unprotected(void);
void eeprom_protect(void);
void eeprom_n_write(EEPROM_ADR adr, BYTE *buf, int len);
void eeprom_n_read(EEPROM_ADR adr, BYTE *buf, int len);



//********************************************************
// eeprom_send_adr
//********************************************************
void eeprom_send_adr(EEPROM_ADR adr)
{
#if EEPROM_ADR_BITS == 24
    l_WriteSPI1(adr >> 16);
#endif
    l_WriteSPI1(adr >> 8);
    l_WriteSPI1(adr);
}

//========================================================
// eeprom_wrsr 少し時間がかかる　RDSRで書き込み完了をチェック
//========================================================
void eeprom_wrsr(char val)
{
    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_WRSR);
    l_WriteSPI1(val);
    EEPROM_CS_OFF();
}

//========================================================
// eeprom_write_byte
//========================================================
void eeprom_write_byte(EEPROM_ADR adr,BYTE data)
{
    EEPROM_CS_ON();

    l_WriteSPI1(EEPROM_INST_WRITE);

    eeprom_send_adr(adr);

    l_WriteSPI1(data);

    EEPROM_CS_OFF();
}

//========================================================
// eeprom_write_word
//========================================================
void eeprom_write_word(EEPROM_ADR adr,WORD data)
{
    eeprom_write_byte(adr  , (BYTE)((data >> 8) & 0xFF));
    eeprom_write_byte(adr+1, (BYTE)(data & 0xFF));
}

//========================================================
// eeprom_rdsr
//========================================================
BYTE eeprom_rdsr(void)
{
    volatile BYTE result;

    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_RDSR);
    result = l_ReadSPI1();
    EEPROM_CS_OFF();

    return result;
}

//========================================================
// eeprom_busy
//========================================================
BYTE eeprom_busy(void)
{
    volatile BYTE result;

    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_RDSR);
    result = l_ReadSPI1();;
    EEPROM_CS_OFF();

    result &= 0x01;

    return result;
}

//========================================================
// eeprom_wait_wip
//========================================================
void eeprom_wait_wip(void)
{
    BYTE result;

    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_RDSR);
    do{
        result = l_ReadSPI1();
    }while(result & 0x01);

    EEPROM_CS_OFF();
}

//========================================================
// eeprom_read_byte
//========================================================
BYTE eeprom_read_byte(EEPROM_ADR adr)
{
    BYTE data;

    EEPROM_CS_OFF();
    EEPROM_CS_ON();

    l_WriteSPI1(EEPROM_INST_READ);
    eeprom_send_adr(adr);
    data = l_ReadSPI1();

    EEPROM_CS_OFF();

    return data;
}

//========================================================
// eeprom_read_word
//========================================================
WORD eeprom_read_word(EEPROM_ADR adr)
{
    WORD val;
    val  = ((WORD)eeprom_read_byte(adr)) << 8;
    val |= eeprom_read_byte(adr+1);
    return val;
}

//========================================================
// eeprom_read_adr
//========================================================
void eeprom_read_adr(EEPROM_ADR adr)
{
    EEPROM_CS_OFF();
    EEPROM_CS_ON();

    l_WriteSPI1(EEPROM_INST_READ);
    eeprom_send_adr(adr);

//  EEPROM_CS_OFF();
}

//========================================================
// eeprom_wren
//========================================================
void eeprom_wren(void)
{
    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_WREN);
    EEPROM_CS_OFF();
}

//========================================================
// eeprom_wrdi
//========================================================
void eeprom_wrdi(void)
{
    EEPROM_CS_ON();
    l_WriteSPI1(EEPROM_INST_WRDI);
    EEPROM_CS_OFF();
}

//========================================================
// eeprom_continuous_start
//========================================================
void eeprom_continuous_start(void)
{
    EEPROM_CS_ON();
}

//========================================================
// eeprom_continuous_end
//========================================================
void eeprom_continuous_end(void)
{
    EEPROM_CS_OFF();
}

//========================================================
// eeprom_continuous_write
//========================================================
void eeprom_continuous_write(EEPROM_ADR adr)
{
    l_WriteSPI1(EEPROM_INST_WRITE);
    eeprom_send_adr(adr);
}

//========================================================
// eeprom_continuous_read
//========================================================
void eeprom_continuous_read(EEPROM_ADR adr)
{
    l_WriteSPI1(EEPROM_INST_READ);
    eeprom_send_adr(adr);
}

//========================================================
// eeprom_continuous_access_w (Write)
//========================================================
BYTE eeprom_continuous_access_w(BYTE data)
{
    return l_WriteSPI1(data);
}

//========================================================
// eeprom_continuous_access_r (Read)
//========================================================
BYTE eeprom_continuous_access_r()
{
    return l_ReadSPI1();
}

//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
// eeprom_unprotected
//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
void eeprom_unprotected(void)
{
    eeprom_wren();
    eeprom_wrsr(0x00);
    eeprom_wait_wip();
}

//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
// eeprom_protect
//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
void eeprom_protect(void)
{
    eeprom_wren();
    eeprom_wrsr(0x0C);
    eeprom_wait_wip();
}

//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
// eeprom_n_write
//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
void eeprom_n_write(EEPROM_ADR adr, BYTE *buf, int len)
{
    int i;
    eeprom_wren();
    eeprom_continuous_start();
    eeprom_continuous_write(adr);
    for(i=0;i<len;i++){
        eeprom_continuous_access_w(*buf++);
    }
    eeprom_continuous_end();
    eeprom_wait_wip();
}

//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
// eeprom_n_read
//::::::::::::::::::::::::::::::::::::::::::::::::::::::::
void eeprom_n_read(EEPROM_ADR adr, BYTE *buf, int len)
{
    int i;
    eeprom_continuous_start();
    eeprom_continuous_read(adr);
    for(i=0;i<len;i++){
        *buf++ = eeprom_continuous_access_r();
    }
    eeprom_continuous_end();
}



//
void u_SWInfo_buffClr(UN_SW_INFOS* p_sw_infos)
{
	int fi;
	int bufsize = sizeof(UN_SW_INFOS);
//	int bufsize = sizeof(p_sw_infos->byte);
	for( fi = 0; fi < bufsize; fi++ )
	{
		p_sw_infos->byte[fi] = 0x00;
	}
}
void u_ANInfo_buffClr(UN_AN_INFOS* p_an_infos)
{
	int fi;
	int bufsize = sizeof(UN_AN_INFOS);
//	int bufsize = sizeof(p_an_infos->byte);
	for( fi = 0; fi < bufsize; fi++ )
	{
		p_an_infos->byte[fi] = 0x00;
	}
}
int u_GetSWInfo(UN_SW_INFOS* p_sw_info)
{
	EEPROM_ADR adr;
    
	adr = (EEPROM_ADR)(EEPROM_SW_SETTION_ADR);
	eeprom_n_read(adr, &p_sw_info->byte[0], sizeof(p_sw_info->byte));
//	eeprom_n_read(adr, &p_sw_info->byte[0], EEPROM_SW_SETTION_SIZE*SW_SETTING_NUM);
    
	return 0;
}
int u_GetANInfo(UN_AN_INFOS* p_an_info)
{
	EEPROM_ADR adr;
    
	adr = (EEPROM_ADR)(EEPROM_AN_SETTION_ADR);
	eeprom_n_read(adr, &p_an_info->byte[0], sizeof(p_an_info->byte));
//	eeprom_n_read(adr, &p_an_info->byte[0], EEPROM_AN_SETTION_SIZE*ANALOG_SETTING_NUM);
    
	return 0;
}

